(()=>{"use strict";const t={x:null,y:null,dx:1,dy:0,tail:null,body:null,update:function(t,e,n){this.body.push({x:this.x,y:this.y}),this.x+=this.dx,this.y+=this.dy,this.body.forEach(((o,l)=>{l===this.body.length-1?t.fillStyle="blue":t.fillStyle="green",t.fillRect(o.x*e,o.y*e,e-2,e-2),this.x===o.x&&this.y===o.y&&n.gameStopFunc()})),this.body.length>this.tail&&this.body.shift()}};class e{constructor(t,e=null,n=null){this.x=e,this.y=n,this.img=t}update(t,e){t.drawImage(this.img,this.x*e,this.y*e,e,e)}}const n=(t,e,n,o,l)=>{const r=Math.abs(t-n),d=Math.abs(e-o);return Math.sqrt(r*r+d*d)>=l},o=(t,e,o,l)=>{let r,d;do{r=Math.floor(Math.random()*o),d=Math.floor(Math.random()*o)}while(1===e[d][r]||!n(r,d,l.x,l.y,5));t.x=r,t.y=d,e[d][r]=1},l=(t,e,n,l)=>{o(t,e,n,l)},r=()=>fetch("http://localhost:3000/records").then((t=>t.json())).catch((t=>console.error("エラー:",t))),d={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a;const s=new Uint8Array(16);function c(){if(!a&&(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));const u=function(t,e,n){if(d.randomUUID&&!e&&!t)return d.randomUUID();const o=(t=t||{}).random||(t.rng||c)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=o[t];return e}return function(t,e=0){return i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]}(o)},h=document.getElementById("canvas"),y=h.getContext("2d"),m=document.getElementById("bgCanvas"),p=m.getContext("2d"),g=document.getElementById("start-button"),f=document.getElementById("name-text");h.width=400,h.height=400,m.width=400,m.height=400,m.setAttribute("style","position: absolute; z-index: -1"),h.setAttribute("style","position: absolute; z-index: 1"),document.body.appendChild(m),document.body.appendChild(h);const x=document.getElementById("appleImage"),I=document.getElementById("goldAppleImage"),b=document.getElementById("wallImage"),w=20,S=h.width/w,E={gameStop:!1,gameStopFunc:function(){this.gameStop=!0,T()}};let v=[];const A=new e(x),U=new e(I);let B=[],C=Array.from({length:20},(()=>Array(20).fill(0)));const k=()=>{if(!E.gameStop){if(v.length>0){const e=v.shift();t.dx=e.dx,t.dy=e.dy}y.clearRect(0,0,h.width,h.height),t.update(y,w,E),A.update(y,w),B.forEach((t=>t.update(y,w))),null!==U.x&&null!==U.y&&U.update(y,w),t.x<0&&(t.x=S-1),t.y<0&&(t.y=S-1),t.x>S-1&&(t.x=0),t.y>S-1&&(t.y=0),t.x===A.x&&t.y===A.y&&(t.tail++,document.getElementById("snake-length").innerText="蛇の長さ: "+t.tail,l(A,C,S,t)),t.x===U.x&&t.y===U.y&&(t.tail+=2,document.getElementById("snake-length").innerText="蛇の長さ: "+t.tail,U.x=null,U.y=null),B.some((e=>t.x===e.x&&t.y===e.y&&(E.gameStopFunc(),!0)))}};let D,M,R;g.addEventListener("click",(()=>{clearInterval(D),clearInterval(M),clearInterval(R),(()=>{for(let t=0;t<S;t++)for(let e=0;e<S;e++)p.fillStyle="#aaa",p.fillRect(t*w,e*w,19,19);E.gameStop=!1,(e=>{t.x=e/2,t.y=e/2,t.tail=4,t.body=[],t.dx=1,t.dy=0})(S),l(A,C,S,t),U.x=null,U.y=null,B=[],C=Array.from({length:20},(()=>Array(20).fill(0))),v=[]})(),D=setInterval(k,125),M=setInterval((()=>((t,n,l,r,d)=>{const a=new e(r);o(a,n,l,d),t.push(a)})(B,C,S,b,t)),5e3),R=setInterval((()=>((t,e,n,l)=>{o(t,e,n,l)})(U,C,S,t)),15e3)})),document.addEventListener("keydown",(t=>{let e;switch(t.key){case"ArrowLeft":e={dx:-1,dy:0};break;case"ArrowRight":e={dx:1,dy:0};break;case"ArrowUp":e={dx:0,dy:-1};break;case"ArrowDown":e={dx:0,dy:1}}e&&v.push(e)}));const j=(()=>{let t=localStorage.getItem("uniqueID");return console.log("store: "+t),null===t&&(t=u(),localStorage.setItem("uniqueID",t),console.log(t)),t})();r().then((t=>{const e=t.map((t=>({name:t.name,record:t.record,uid:t.uid}))),n=document.getElementById("output");e.forEach(((t,e)=>{const o=document.createElement("div");t.uid===j&&o.classList.add("bold"),o.textContent=`${e+1}位: ${t.name} 記録: ${t.record}`,n.appendChild(o)}))}));const T=()=>{const e=f.value,n=t.tail;/\S/.test(e)&&((t,e,n)=>{r().then((o=>{const l=o.map((t=>({name:t.name,record:t.record,uid:t.uid})));let r=!1;for(let t=0;t<l.length;t++){const o=l[t];if(o.uid===n){if(o.record>e)return;r=!0}}r?((t,e,n)=>{const o={name:t,record:e};fetch(`http://localhost:3000/record/${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((t=>t.json())).then((t=>{console.log("サーバからのレスポンス:",t)})).catch((t=>{console.error("エラー:",t)}))})(t,e,n):((t,e,n)=>{const o={name:t,record:e,uid:n};fetch("http://localhost:3000/record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((t=>t.json())).then((t=>{console.log("サーバからのレスポンス:",t)})).catch((t=>{console.error("エラー:",t)}))})(t,e,n)}))})(e,n,j)}})();