(()=>{"use strict";const t={x:null,y:null,dx:1,dy:0,tail:null,body:null,update:function(t,e,n){this.body.push({x:this.x,y:this.y}),this.x+=this.dx,this.y+=this.dy,this.body.forEach(((o,l)=>{l===this.body.length-1?t.fillStyle="blue":t.fillStyle="green",t.fillRect(o.x*e,o.y*e,e-2,e-2),this.x===o.x&&this.y===o.y&&n.gameStopFunc()})),this.body.length>this.tail&&this.body.shift()}};class e{constructor(t,e=null,n=null){this.x=e,this.y=n,this.img=t}update(t,e){t.drawImage(this.img,this.x*e,this.y*e,e,e)}}const n=(t,e,n,o,l)=>{const a=Math.abs(t-n),r=Math.abs(e-o);return Math.sqrt(a*a+r*r)>=l},o=(t,e,o,l)=>{let a,r;do{a=Math.floor(Math.random()*o),r=Math.floor(Math.random()*o)}while(1===e[r][a]||!n(a,r,l.x,l.y,5));t.x=a,t.y=r,e[r][a]=1},l=(t,e,n,l)=>{o(t,e,n,l)},a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let r;const d=new Uint8Array(16);function s(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(d)}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));const c=function(t,e,n){if(a.randomUUID&&!e&&!t)return a.randomUUID();const o=(t=t||{}).random||(t.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=o[t];return e}return function(t,e=0){return i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]}(o)},u=document.getElementById("canvas"),y=u.getContext("2d"),h=document.getElementById("bgCanvas"),m=h.getContext("2d"),g=document.getElementById("start-button"),p=document.getElementById("name-text");u.width=400,u.height=400,h.width=400,h.height=400,h.setAttribute("style","position: absolute; z-index: -1"),u.setAttribute("style","position: absolute; z-index: 1"),document.body.appendChild(h),document.body.appendChild(u);const x=document.getElementById("appleImage"),f=document.getElementById("goldAppleImage"),I=document.getElementById("wallImage"),b=20,w=u.width/b,E={gameStop:!1,gameStopFunc:function(){this.gameStop=!0,R()}};let S=[];const v=new e(x),A=new e(f);let U=[],B=Array.from({length:20},(()=>Array(20).fill(0)));const k=()=>{if(!E.gameStop){if(S.length>0){const e=S.shift();t.dx=e.dx,t.dy=e.dy}y.clearRect(0,0,u.width,u.height),t.update(y,b,E),v.update(y,b),U.forEach((t=>t.update(y,b))),null!==A.x&&null!==A.y&&A.update(y,b),t.x<0&&(t.x=w-1),t.y<0&&(t.y=w-1),t.x>w-1&&(t.x=0),t.y>w-1&&(t.y=0),t.x===v.x&&t.y===v.y&&(t.tail++,document.getElementById("snake-length").innerText="蛇の長さ: "+t.tail,l(v,B,w,t)),t.x===A.x&&t.y===A.y&&(t.tail+=2,document.getElementById("snake-length").innerText="蛇の長さ: "+t.tail,A.x=null,A.y=null),U.some((e=>t.x===e.x&&t.y===e.y&&(E.gameStopFunc(),!0)))}};let C,D,M;g.addEventListener("click",(()=>{clearInterval(C),clearInterval(D),clearInterval(M),(()=>{for(let t=0;t<w;t++)for(let e=0;e<w;e++)m.fillStyle="#aaa",m.fillRect(t*b,e*b,19,19);E.gameStop=!1,(e=>{t.x=e/2,t.y=e/2,t.tail=4,t.body=[],t.dx=1,t.dy=0})(w),l(v,B,w,t),A.x=null,A.y=null,U=[],B=Array.from({length:20},(()=>Array(20).fill(0))),S=[]})(),C=setInterval(k,125),D=setInterval((()=>((t,n,l,a,r)=>{const d=new e(a);o(d,n,l,r),t.push(d)})(U,B,w,I,t)),5e3),M=setInterval((()=>((t,e,n,l)=>{o(t,e,n,l)})(A,B,w,t)),15e3)})),document.addEventListener("keydown",(t=>{let e;switch(t.key){case"ArrowLeft":e={dx:-1,dy:0};break;case"ArrowRight":e={dx:1,dy:0};break;case"ArrowUp":e={dx:0,dy:-1};break;case"ArrowDown":e={dx:0,dy:1}}e&&S.push(e)})),(()=>{const t=localStorage.getItem("uniqueID");if(console.log("store: "+t),null===t){const t=c();localStorage.setItem("uniqueID",t),console.log(t)}})(),fetch("http://localhost:3000/foods").then((t=>t.json())).catch((t=>console.error("エラー:",t))).then((t=>{const e=t.map((t=>({name:t.name,calories:t.calories}))),n=document.getElementById("output");e.forEach((t=>{const e=document.createElement("div");e.textContent=`${t.name} 記録: ${t.calories}`,n.appendChild(e)}))}));const R=()=>{const e=p.value,n=t.tail;/\S/.test(e)&&((t,e)=>{const n={name:t,record:e};fetch("http://localhost:3000/food",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((t=>t.json())).then((t=>{console.log("サーバからのレスポンス:",t)})).catch((t=>{console.error("エラー:",t)}))})(e,n)}})();